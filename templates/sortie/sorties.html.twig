{% extends 'base.html.twig' %}

{% block title %}Sorties disponibles{% endblock %}

{% block main %}
    <!-- Header Section avec votre palette -->
    <section class="uk-section uk-preserve-color cm-background-charcoal uk-light">
        <div class="uk-container uk-container-large">
            <div class="uk-text-center">
                <h1 class="uk-heading-large uk-margin-remove-bottom">Les sorties disponibles</h1>
                <p class="uk-text-large uk-margin-small-top cm-text-saffron">Découvrez toutes les activités proposées</p>
            </div>
        </div>
    </section>

    <!-- Grid des sorties -->
    <section class="uk-section uk-section-default ">
        <div class="uk-container uk-container-large">
            <div class="uk-child-width-1-1 uk-child-width-1-2@s uk-child-width-1-3@l" uk-grid="masonry: true"
                 uk-scrollspy="cls: uk-animation-slide-bottom-small; target: .uk-card; delay: 100; repeat: false">
                {% for sortie in allSorties %}
                    <div>
                        <div class="uk-card uk-card-default uk-card-hover uk-border-rounded uk-overflow-hidden uk-height-1-1">

                            <!-- Image avec overlay -->
                            <div class="uk-card-media-top uk-inline uk-transition-toggle">
                                <img class="uk-transition-scale-up uk-transition-opaque"

                                     {% if sortie.photo %}
                                        src="{{ sortie.photo }}"
                                     {% else %}
                                     data-src="https://picsum.photos/400/300/?random={{ sortie.id }}"
                                     {% endif %}
                                     alt="{{ sortie.nom }}"
                                     uk-img>

                                <!-- Badge statut avec votre palette -->
                                <div class="uk-position-top-right uk-position-small">
                                    {% if sortie.nbInscrits >= sortie.nbInscriptionMax %}
                                        <span class="uk-label cm-background-burnt-sienna uk-light">Complet</span>
                                    {% elseif sortie.dateLimiteInscription|date('U') < 'now'|date('U') %}
                                        <span class="uk-label cm-background-sandy-brown uk-light">Inscriptions fermées</span>
                                    {% else %}
                                        <span class="uk-label cm-background-persian-green uk-light">Disponible</span>
                                    {% endif %}
                                </div>

                                <!-- Quick actions overlay -->
                                <a class="uk-text-decoration-none uk-display-block uk-height-1-1"
                                   href="{{ path('sorties_detail', {id: sortie.id}) }}">
                                    <div class="uk-position-cover uk-overlay uk-transition-fade uk-flex uk-flex-center uk-flex-middle" style="background-color: rgba(38, 70, 83, 0.8);">
                                        <div class="uk-text-center">
                                            <span uk-icon="icon: plus; ratio: 2" class="cm-text-saffron"></span>
                                            <p class="uk-text-small uk-margin-small-top uk-light">Voir les détails</p>
                                        </div>
                                    </div>
                                </a>
                            </div>

                            <!-- Contenu de la carte -->
                            <div class="uk-card-body uk-padding-small">
                                <!-- Titre et description -->
                                <div class="uk-margin-small-bottom">
                                    <h3 class="uk-card-title uk-margin-remove-bottom uk-text-truncate cm-text-charcoal">
                                        {{ sortie.nom }}
                                    </h3>
                                    <p class="uk-text-meta uk-margin-small-top uk-text-small cm-text-charcoal" style="opacity: 0.7;">
                                        {{ sortie.infos|length > 100 ? sortie.infos|slice(0, 100) ~ '...' : sortie.infos }}
                                    </p>
                                </div>

                                <!-- Informations principales -->
                                <div class="uk-margin-small">
                                    <!-- Dates -->
                                    <div class="uk-flex uk-flex-middle uk-margin-small-bottom">
                                        <span uk-icon="icon: calendar; ratio: 0.8"
                                              class="cm-text-persian-green uk-margin-small-right"></span>
                                        <div>
                                            <div class="uk-text-small uk-text-bold cm-text-charcoal">{{ sortie.dateHeureDebut|date('d/m/Y H:i') }}</div>
                                            <div class="uk-text-meta uk-text-small">Début de l'activité</div>
                                        </div>
                                    </div>

                                    <!-- Limite d'inscription -->
                                    <div class="uk-flex uk-flex-middle uk-margin-small-bottom">
                                        <span uk-icon="icon: clock; ratio: 0.8"
                                              class="cm-text-sandy-brown uk-margin-small-right"></span>
                                        <div>
                                            <div class="uk-text-small uk-text-bold cm-text-charcoal">{{ sortie.dateLimiteInscription|date('d/m/Y H:i') }}</div>
                                            <div class="uk-text-meta uk-text-small">Limite d'inscription</div>
                                        </div>
                                    </div>

                                    <!-- Participants avec barre de progression -->
                                    <div class="uk-margin-small-bottom">
                                        <div class="uk-flex uk-flex-between uk-flex-middle uk-margin-small-bottom">
                                                <span class="uk-flex uk-flex-middle">
                                                    <span uk-icon="icon: users; ratio: 0.8"
                                                          class="cm-text-persian-green uk-margin-small-right"></span>
                                                    <span class="uk-text-small cm-text-charcoal">Participants</span>
                                                </span>
                                            <span class="uk-text-small uk-text-bold cm-text-charcoal">
                                                    {{ sortie.nbInscrits }} / {{ sortie.nbInscriptionMax }}
                                                </span>
                                        </div>

                                        <!-- Barre de progression avec votre couleur -->
                                        <progress class="uk-progress uk-progress-small"
                                                  value="{{ sortie.nbInscrits }}"
                                                  max="{{ sortie.nbInscriptionMax }}"
                                                  style="--uk-progress-color: rgba(42, 157, 143, 1);">
                                        </progress>
                                    </div>
                                </div>
                            </div>

                            <!-- Footer de la carte -->
                            <div class="uk-card-footer uk-padding-small" style="background-color: #f8f9fa; border-top: 1px solid #e9ecef;">
                                <div class="uk-grid-small uk-flex-middle" uk-grid>
                                    <div class="uk-width-expand">
                                        <div class="uk-flex uk-flex-middle">
                                            <span uk-icon="icon: location; ratio: 0.8"
                                                  class="cm-text-persian-green uk-margin-small-right"></span>
                                            <span class="uk-text-small uk-text-bold cm-text-charcoal">{{ sortie.campus.nom }}</span>
                                        </div>
                                    </div>
                                    <div class="uk-width-auto">
                                        <div class="uk-flex uk-flex-middle">
                                            <span uk-icon="icon: user; ratio: 0.8"
                                                  class="cm-text-sandy-brown uk-margin-small-right"></span>
                                            <span class="uk-text-small cm-text-charcoal">{{ sortie.organisateur.nom }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Message si aucune sortie -->
            {% if allSorties is empty %}
                <div class="uk-text-center uk-margin-large">
                    <span uk-icon="icon: warning; ratio: 3" class="cm-text-sandy-brown"></span>
                    <h3 class="cm-text-charcoal">Aucune sortie disponible pour le moment</h3>
                    <p class="cm-text-charcoal" style="opacity: 0.7;">Revenez plus tard pour découvrir de nouvelles activités !</p>
                </div>
            {% endif %}
        </div>
    </section>

    <!-- Section Call-to-Action -->
    <section class="uk-section cm-background-charcoal uk-light uk-section-large">
        <div class="uk-container uk-text-center">
            <h2 class="uk-heading-medium">Envie d'organiser une sortie ?</h2>
            <p class="uk-text-large uk-margin-medium-bottom cm-text-saffron">Proposez votre propre activité à la communauté</p>
            <a href="{{ path('sorties_create') }}" class="uk-button cm-background-persian-green uk-light uk-button-large">
                <span uk-icon="plus"></span> Créer une sortie
            </a>
        </div>
    </section>
{% endblock %}