{% extends 'base.html.twig' %}

{% block title %}Sorties disponibles{% endblock %}

{% block main %}
    <section class="uk-section uk-preserve-color cm-background-charcoal uk-light">
        <div class="uk-container uk-container-large">
            <div class="uk-text-center">
                <h1 class="uk-heading-large uk-margin-remove-bottom">Création d'une activité</h1>
                <p class="uk-text-large uk-margin-small-top cm-text-saffron">Découvrez toutes les activités
                    proposées</p>
            </div>
        </div>
    </section>

    <!-- Form -->
    <section>
        {{ form_start(formSortie, {
            method: 'post',
            attr: {enctype: 'multipart/form-data',
                id: 'sortie-form'}
        }) }}
        <!-- Section 1: Informations principales -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Informations principales
            </h3>

            <div class="uk-margin">
                {{ form_row(formSortie.nom) }}
            </div>
        </div>

        <!-- Section 2: Planning -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Planning et timing
            </h3>

            <div class="uk-grid-small uk-child-width-1-3@m" uk-grid>
                <div>
                    {{ form_row(formSortie.dateHeureDebut) }}
                </div>
                <div>
                    {{ form_row(formSortie.dateLimiteInscription) }}
                </div>
                <div>
                    {{ form_row(formSortie.duree) }}
                </div>
            </div>
        </div>

        <!-- Section 3: Photo -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Image de la sortie
            </h3>

            <div class="uk-margin">
                <div class="uk-placeholder uk-text-center cm-photo-upload uk-border-rounded">
                    <span uk-icon="icon: camera; ratio: 2" class="uk-text-muted"></span>
                    <p class="uk-text-lead uk-margin-remove-bottom">Cliquez pour ajouter une photo</p>
                    <p class="uk-text-meta">Formats acceptés: JPG et PNG (max 2MB)</p>

                    {{ form_row(formSortie.photo) }}
                </div>
            </div>
        </div>

        <!-- Section 4: Participants -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Participants et centres d'intérets
            </h3>

            <div class="uk-grid-small uk-child-width-1-3@m" uk-grid>
                <div>
                    {{ form_row(formSortie.nbInscriptionMin) }}
                </div>
                <div>
                    {{ form_row(formSortie.nbInscriptionMax) }}
                </div>
                <div>
                    {{ form_row(formSortie.interets) }}
                </div>
            </div>
        </div>

        <!-- Section 5: Description -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Description de la sortie
            </h3>

            <div class="uk-margin">
                {{ form_row(formSortie.infos) }}
            </div>
        </div>

        <!-- Section 6: Localisation -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Localisation et lieu de rendez-vous
            </h3>
            <div>
                <!-- Campus et Lieu -->
                <div class="uk-grid-small uk-child-width-1-3@m uk-margin" uk-grid>
                    <div>
                        <div class="uk-margin-small-bottom">
                            {{ form_widget(formSortie.campus, {'attr': {'id': 'campus-select'}}) }}
                        </div>

                        <div>
                            {{ form_widget(formSortie.lieu, {'attr': {'id': 'lieu-select'}}) }}
                        </div>
                        <div>
                            <button class="uk-button uk-button-primary" type="button" uk-toggle="target: #mon-modal"
                                    id="ajoutLieu">
                                Ajouter un lieu
                            </button>
                        </div>
                    </div>

                    <!-- Adresse complète -->
                    <div class="uk-grid-small uk-child-width-1-3@m" uk-grid>
                        <div>
                            <label class="uk-form-label">Adresse</label>
                            <input type="text" class="uk-input" readonly
                                   placeholder="Adresse du lieu" id="adresse-field">
                        </div>
                        <div>
                            <label class="uk-form-label">Ville</label>
                            <input type="text" class="uk-input" readonly
                                   placeholder="Ville" id="ville-field">
                        </div>
                        <div>
                            <label class="uk-form-label">Code Postal</label>
                            <input type="text" class="uk-input" readonly
                                   placeholder="Code postal" id="codepostal-field">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boutons d'action -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-text-center">
            <div class="uk-flex uk-flex-center uk-flex-middle uk-grid-small" uk-grid>
                <div>{{ form_row(formSortie.cancel) }}</div>
                <div>{{ form_row(formSortie.createSortie) }}</div>
            </div>
        </div>

        {{ form_end(formSortie) }}
    </section>

    <!-- Modal pour ajouter un lieu -->
    <div id="mon-modal" uk-modal>
        <div class="uk-modal-dialog uk-modal-body">
            <h2 class="uk-modal-title">Ajouter un lieu</h2>

            <!-- Zone pour afficher les messages d'erreur/succès -->
            <div id="messages"></div>

            <!-- Formulaire lieu -->
            <div>
                {{ form_start(formLieu, {
                    method: 'post',
                    attr: {enctype: 'multipart/form-data',
                        id: 'lieu-form',
                    }
                }) }}
                <div class="uk-margin">
                    <div class="uk-form-controls">
                        {{ form_row(formLieu.campus) }}
                    </div>
                </div>
                <div class="uk-margin">
                    <div class="uk-form-controls">
                        {{ form_row(formLieu.nom) }}
                    </div>
                </div>
                <div class="uk-margin">
                    <div class="uk-form-controls">
                        {{ form_row(formLieu.rue) }}
                    </div>
                </div>
                <div class="uk-margin">
                    <div class="uk-form-controls">
                        {{ form_row(formLieu.ville) }}
                    </div>
                </div>

                <div class="uk-flex uk-flex-center uk-flex-middle uk-grid-small" uk-grid>
                    <div>{{ form_row(formLieu.cancel) }}</div>
                    <div>{{ form_row(formLieu.createLieu) }}</div>
                </div>
                {{ form_end(formLieu) }}
            </div>
        </div>
    </div>


    <div id="app-data" style="display: none;"
         data-lieux="{{ lieux|json_encode|e('html_attr') }}"
            {% if lieuIdToSelect is defined %}
        data-lieu-to-select="{{ lieuIdToSelect }}"
            {% endif %}>
    </div>

    <!-- Script JavaScript -->
    <script src="{{ asset('js/sortie-form.js') }}"></script>
{% endblock %}