{% extends 'base.html.twig' %}

{% block title %}Créer une sortie  | {{ parent() }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
    <link rel="stylesheet" href="{{ asset('/styles/create-sortie.css') }}">
{% endblock %}

{% block main %}
    <section class="uk-section uk-preserve-color cm-background-charcoal uk-light">
        <div class="uk-container uk-container-large">
            <div class="uk-text-center">
                <h1 class="uk-heading-large uk-margin-remove-bottom">Création d'une activité</h1>
                <p class="uk-text-large uk-margin-small-top cm-text-saffron">Découvrez toutes les activités
                    proposées</p>
            </div>
        </div>
    </section>

    <!-- Form -->
    <section>
        {{ form_start(formSortie, {
            method: 'post',
            attr: {enctype: 'multipart/form-data',
                id: 'sortie-form'}
        }) }}
        <!-- Section 1: Informations principales -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Informations principales
            </h3>

            <div class="uk-margin">
                {{ form_row(formSortie.nom) }}
            </div>
        </div>

        <!-- Section 2: Planning -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Planning et timing
            </h3>

            <div class="uk-grid-small uk-child-width-1-3@m" uk-grid>
                <div>
                    {{ form_row(formSortie.dateHeureDebut) }}
                </div>
                <div>
                    {{ form_row(formSortie.dateLimiteInscription) }}
                </div>
                <div>
                    {{ form_row(formSortie.duree) }}
                </div>
            </div>
        </div>

        <!-- Section 3: Photo -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Image de la sortie
            </h3>

            <div class="uk-margin">
                <div class="uk-placeholder uk-text-center cm-photo-upload uk-border-rounded">
                    <span uk-icon="icon: camera; ratio: 2" class="uk-text-muted"></span>
                    <p class="uk-text-lead uk-margin-remove-bottom">Cliquez pour ajouter une photo</p>
                    <p class="uk-text-meta">Formats acceptés: JPG et PNG (max 2MB)</p>

                    {{ form_row(formSortie.photo) }}
                </div>
            </div>
        </div>

        <!-- Section 4: Participants -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Participants et centres d'intérets
            </h3>

            <div class="uk-grid-small uk-child-width-1-3@m" uk-grid>
                <div>
                    {{ form_row(formSortie.nbInscriptionMin) }}
                </div>
                <div>
                    {{ form_row(formSortie.nbInscriptionMax) }}
                </div>
                <div>
                    {{ form_row(formSortie.interets) }}
                </div>
            </div>
        </div>

        <!-- Section 5: Description -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Description de la sortie
            </h3>

            <div class="uk-margin">
                {{ form_row(formSortie.infos) }}
            </div>
        </div>

        <!-- Section 6: Localisation -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-margin-bottom cm-form-section">
            <h3 class="uk-card-title uk-flex uk-flex-middle uk-margin-medium-bottom">
                <span class="cm-section-icon uk-margin-small-right"></span>
                Localisation et lieu de rendez-vous
            </h3>
            <div>
                <!-- Campus et Lieu -->
                <div class="uk-grid-small uk-child-width-1-2@m uk-margin" uk-grid>
                    <div>
                        <div class="uk-margin-small-bottom">
                            {{ form_widget(formSortie.campus, {'attr': {'id': 'campus-select'}}) }}
                        </div>

                        <div class="uk-margin-small-bottom">
                            {{ form_widget(formSortie.lieu, {'attr': {'id': 'lieu-select'}}) }}
                        </div>
                        <div>
                            <button class="uk-button uk-border-pill uk-button-primary uk-button-green" type="button"
                                    uk-toggle="target: #mon-modal"
                                    id="ajoutLieu">
                                Ajouter un lieu
                            </button>
                        </div>
                        {#                    </div> #}

                        <!-- Adresse complète -->
                        {#                    <div class="uk-grid-small uk-child-width-1-3@m" uk-grid> #}
                        <div class="uk-margin-small-bottom">
                            <label class="uk-form-label">Adresse</label>
                            <input type="text" class="uk-input" readonly
                                   placeholder="Adresse du lieu" id="adresse-field">
                        </div>
                        <div class="uk-margin-small-bottom">
                            <label class="uk-form-label">Ville</label>
                            <input type="text" class="uk-input" readonly
                                   placeholder="Ville" id="ville-field">
                        </div>
                        <div class="uk-margin-small-bottom">
                            <label class="uk-form-label">Code Postal</label>
                            <input type="text" class="uk-input" readonly
                                   placeholder="Code postal" id="codepostal-field">
                        </div>
                    </div>
                    <div>
                        <label class="uk-form-label">Localisation</label>
                        <div id="sortie-map"
                             style="height: 350px; width: 100%; border-radius: 5px; border: 1px solid #e5e5e5;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Boutons d'action -->
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded uk-text-center">
            <div class="uk-flex uk-flex-center uk-flex-middle uk-grid-small" uk-grid>
                <div>{{ form_row(formSortie.cancel) }}</div>
                <div>{{ form_row(formSortie.createSortie) }}</div>
            </div>
        </div>

        {{ form_end(formSortie) }}
    </section>

    <!-- Modal pour ajouter un lieu -->
    <div id="mon-modal" uk-modal>
{% include '_ajoutLieu.html.twig' %}
    </div>


    <div id="app-data" style="display: none;"
         data-lieux="{{ lieux|json_encode|e('html_attr') }}"
            {% if lieuIdToSelect is defined %}
        data-lieu-to-select="{{ lieuIdToSelect }}"
            {% endif %}>
    </div>

    <!-- Script JavaScript -->

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <!-- Scripts JavaScript de l'application -->
    <script src="{{ asset('js/sortie-form.js') }}" defer></script>
    <script src="{{ asset('js/sortie-map.js') }}" defer></script>
    <script src="{{ asset('js/apiGeo.js') }}" defer></script>

{% endblock %}