{% extends 'base.html.twig' %}

{% block title %}Détails de la sortie{% endblock %}

{% block main %}
    <!-- Affichage messages flash -->
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="uk-alert-{{ label }} uk-margin" uk-alert>
                <a class="uk-alert-close" uk-close></a>
                <p>{{ message }}</p>
            </div>
        {% endfor %}

    {% endfor %}
    <!-- Section titre -->
    <section class="uk-section uk-preserve-color cm-background-charcoal uk-light">
        <div class="uk-container uk-container-large uk-text-center">
            <h1 class="uk-heading-medium uk-margin-remove-bottom">{{ sortie.nom }}</h1>
            <p class="uk-text-large uk-margin-small-top cm-text-saffron">Tous les détails de l'activité</p>
        </div>
    </section>

    <!-- Section détails -->
    <section class="uk-section uk-section-default">
        <div class="uk-container uk-container-large">

            <div class="uk-grid-large" uk-grid>
                <!-- Photos -->
                <section class="uk-section">
                    <div class="uk-container uk-container-small">
                        <div class="uk-card uk-card-default uk-overflow-hidden uk-margin-bottom">
                            <div class="uk-card-media-top uk-inline uk-transition-toggle">
                                <img class="uk-transition-scale-up uk-transition-opaque"
                                        {% if sortie.photo %}
                                            src="{{ sortie.photo }}"
                                        {% else %}
                                            data-src="https://picsum.photos/400/300/?random={{ sortie.id }}"
                                        {% endif %}
                                     alt="{{ sortie.nom }}"
                                     uk-img>
                            </div>
                        </div>

                            <a class="uk-position-center-left uk-position-small uk-hidden-hover" href="#" uk-slidenav-previous uk-slideshow-item="previous"></a>
                            <a class="uk-position-center-right uk-position-small uk-hidden-hover" href="#" uk-slidenav-next uk-slideshow-item="next"></a>
                        </div>

                        <ul class="uk-slideshow-nav uk-dotnav uk-flex-center uk-margin"></ul>
                    </div>
                </div>

                <!-- Infos principales -->
                <div class="uk-width-1-2@s">
                    <ul class="uk-list uk-list-divider uk-text-small cm-text-charcoal">
                        <li>
                            <span uk-icon="icon: location; ratio: 0.9" class="cm-text-persian-green uk-margin-small-right"></span>
                            <strong>Lieu :</strong> {{ sortie.campus.nom }}
                        </li>
                        <li>
                            <span uk-icon="icon: calendar; ratio: 0.9" class="cm-text-persian-green uk-margin-small-right"></span>
                            <strong>Date :</strong> {{ sortie.dateHeureDebut|date('d/m/Y H:i') }}
                        </li>
                        <li>
                            <span uk-icon="icon: users; ratio: 0.9" class="cm-text-persian-green uk-margin-small-right"></span>
                            <strong>Groupe :</strong> {{ sortie.nbInscrits }} participants
                        </li>
                        <li>
                            <span uk-icon="icon: clock; ratio: 0.9" class="cm-text-persian-green uk-margin-small-right"></span>
                            <strong>Durée :</strong> {{ sortie.duree }} min
                        </li>
                        <li>
                            <span uk-icon="icon: user; ratio: 0.9" class="cm-text-sandy-brown uk-margin-small-right"></span>
                            <strong>Organisateur :</strong> {{ sortie.organisateur.nom }}
                        </li>
                    </ul>


                    <!-- Bouton participation -->
                    <div class="uk-margin-top">
                        {% if sortie.nbInscrits >= sortie.nbInscriptionMax and not (app.user and sortie.participants.contains(app.user)) %}

                            <!-- Complet sauf si déjà inscrit -->
                            <button class="uk-button cm-background-burnt-sienna uk-light" disabled>Complet</button>
                        {% elseif app.user and sortie.participants.contains(app.user) %}
                            <!-- Bouton se désinscrire -->
                            <form action="{{ path('sorties_desinscription', {id: sortie.id}) }}" method="post" style="display:inline;">
                                <input type="hidden" name="_token" value="{{ csrf_token('desinscription' ~ sortie.id) }}">
                                <button type="submit" class="uk-button uk-button-danger uk-light">
                                    <span uk-icon="close"></span> Se désinscrire
                                </button>
                            </form>
                        {% elseif app.user %}
                            <!-- Bouton s'inscrire -->
                            <form action="{{ path('sorties_inscription', {id: sortie.id}) }}" method="post" style="display:inline;">
                                <input type="hidden" name="_token" value="{{ csrf_token('inscription' ~ sortie.id) }}">
                                <button type="submit" class="uk-button cm-background-persian-green uk-light">
                                    <span uk-icon="check"></span> Je m'inscris
                                </button>
                            </form>
                        {% else %}
                            <!-- Pas connecté -->
                            <a href="{{ path('app_login') }}" class="uk-button cm-background-persian-green uk-light">
                                Connectez-vous pour vous inscrire
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
