{% extends 'base.html.twig' %}

{% block title %}Importer des utilisateurs | Admin | {{ parent() }}{% endblock %}

{% block main %}

    <h1 class="uk-heading-bullet uk-text-center uk-margin-small-bottom">
        Importer des utilisateurs (via fichier .csv)
    </h1>

    <div class="uk-align-center uk-text-center uk-margin">
        <a class="uk-button uk-button-small uk-button-primary uk-border-pill" href="{{ path('admin_dashboard') }}">
            Revenir au tableau de bord
        </a>
    </div>

    {# Section de gestion des erreurs #}
    {% for label, messages in app.flashes %}
        {% for message in messages %}
            <div class="uk-alert-{{ label == 'danger' ? 'danger' : (label == 'success' ? 'success' : 'primary') }} uk-margin"
                 uk-alert>
                <a class="uk-alert-close" uk-close></a>
                <p>{{ message|raw }}</p>
            </div>
        {% endfor %}
    {% endfor %}

    <div class="uk-container uk-margin-large-top">
        <div class="uk-card uk-card-default uk-card-body uk-border-rounded">

            {# Format attendu + téléchargement (colonne gauche) #}
            <h3 class="uk-card-title uk-margin-remove-bottom">
                <span uk-icon="icon: warning"></span>Format attendu</h3>
            <p class="uk-text-meta uk-margin-small-top">
                Les colonnes sont <strong>obligatoires</strong> et doivent être dans cet ordre :
                <code>email, prenom, nom, password, campus</code>
            </p>

            <div class="uk-child-width-1-2@s uk-grid-large uk-margin" uk-grid>
                <div>
                    <div class="uk-alert-primary" uk-alert>
                        <p class="uk-margin-small">Exemple valide :</p>
                        <pre class="uk-margin-small uk-overflow-auto">
                            email,prenom,nom,password,campus
                            alice.dupont@campus-eni.fr,Alice,Dupont,MonPass123!,Nantes
                            bruno.martin@campus-eni.fr,Bruno,Martin,Secret42?,Rennes
                            clara.moreau@campus-eni.fr,Clara,Moreau,Azerty!2025,Niort
                        </pre>
                        <a class="uk-button uk-button-primary uk-border-pill uk-width-1-1"
                           href="{{ asset('files/modele_import_utilisateurs.csv') }}"
                           download
                           aria-label="Télécharger le modèle CSV">
                            <span uk-icon="download"></span> Télécharger le modèle CSV
                        </a>
                    </div>
                </div>

                {# Conseils (colonne droite) #}
                <div>
                    <h4 class="uk-margin-remove">Conseils pour éviter les erreurs</h4>
                    <ul class="uk-list uk-list-bullet uk-text-small uk-margin-small-top">
                        <li>Supprimer la première ligne du fichier avant de l'enregistrer</li>
                        <li>L’email doit se terminer par <code>@campus-eni.fr</code></li>
                        <li>Aucun doublon d’email dans le fichier</li>
                        <li>Le campus doit exister dans votre base</li>

                        <li>Vérifiez l’orthographe exacte des <strong>noms de campus</strong></li>
                        <li>Supprimez les espaces superflus avant/après les valeurs</li>
                        <li>Le mot de passe est <em>hashé</em> côté serveur lors de l’import</li>
                    </ul>
                </div>
            </div>

            {# 3) Formulaire d’envoi CSV #}
            {{ form_start(form, {'attr': {'enctype': 'multipart/form-data', 'class': 'uk-form-stacked'}}) }}
            {{ form_row(form.csvFile, {
                'attr': { 'accept': '.csv' }
            }) }}
            <div class="uk-margin">
                <button class="uk-button uk-button-primary uk-border-pill uk-width-1-1" type="submit"
                        aria-label="Importer le fichier CSV">
                    Importer
                </button>
            </div>
            {{ form_end(form) }}

        </div>
    </div>

{% endblock %}
